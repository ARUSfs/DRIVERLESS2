<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Driverless 2: GroundFiltering Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Driverless 2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">GroundFiltering Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a309b709ff242b65b04b5f22ad501fa08" id="r_a309b709ff242b65b04b5f22ad501fa08"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceGroundFiltering.html#a309b709ff242b65b04b5f22ad501fa08">ransac_ground_filter</a> (pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_plane, pcl::ModelCoefficients::Ptr &amp;coefficients, double threshold)</td></tr>
<tr class="memdesc:a309b709ff242b65b04b5f22ad501fa08"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements ground filtering using ransac segmentation.  <br /></td></tr>
<tr class="separator:a309b709ff242b65b04b5f22ad501fa08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac754e959f8a1371a1d4f36bfa5dc348b" id="r_ac754e959f8a1371a1d4f36bfa5dc348b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceGroundFiltering.html#ac754e959f8a1371a1d4f36bfa5dc348b">ransac_checking_normal_vectors</a> (pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;grid_cloud, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;temp_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;temp_plane, pcl::ModelCoefficients::Ptr &amp;coefficients, double threshold, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_plane, Eigen::Vector3d &amp;prev_normal, Eigen::Vector3d &amp;normal, double angle_threshold)</td></tr>
<tr class="memdesc:ac754e959f8a1371a1d4f36bfa5dc348b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply ransac in the square specified and check if the result plane is in accordance with the previus ground plane by measuring the angle between their normal vectors, repeating the process until it succeed.  <br /></td></tr>
<tr class="separator:ac754e959f8a1371a1d4f36bfa5dc348b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1bc882b476335f839d96597dd767555" id="r_ad1bc882b476335f839d96597dd767555"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceGroundFiltering.html#ad1bc882b476335f839d96597dd767555">grid_ground_filter</a> (pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_plane, pcl::ModelCoefficients::Ptr &amp;coefficients, double threshold, double Mx, double My, double Mz, int number_sections, double angle_threshold)</td></tr>
<tr class="memdesc:ad1bc882b476335f839d96597dd767555"><td class="mdescLeft">&#160;</td><td class="mdescRight">Divide the cloud in the specified numbers of squares as a grid and call the function ransac_checking_normal_vectors on each square, in order to apply ransac checking verifying that what is filtered is the ground.  <br /></td></tr>
<tr class="separator:ad1bc882b476335f839d96597dd767555"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a583f7dbed92468f3ec6993b0abdde77a" id="r_a583f7dbed92468f3ec6993b0abdde77a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceGroundFiltering.html#a583f7dbed92468f3ec6993b0abdde77a">pillar_ground_filter</a> (pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;ground_cloud, double threshold, double Mx, double My, int number_sections)</td></tr>
<tr class="separator:a583f7dbed92468f3ec6993b0abdde77a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad1bc882b476335f839d96597dd767555" name="ad1bc882b476335f839d96597dd767555"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1bc882b476335f839d96597dd767555">&#9670;&#160;</a></span>grid_ground_filter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GroundFiltering::grid_ground_filter </td>
          <td>(</td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_filtered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_plane</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::ModelCoefficients::Ptr &amp;&#160;</td>
          <td class="paramname"><em>coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Mx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>My</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Mz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>number_sections</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>angle_threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Divide the cloud in the specified numbers of squares as a grid and call the function ransac_checking_normal_vectors on each square, in order to apply ransac checking verifying that what is filtered is the ground. </p>

<p class="definition">Definition at line <a class="el" href="ground__filtering_8h_source.html#l00110">110</a> of file <a class="el" href="ground__filtering_8h_source.html">ground_filtering.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  113</span>    {</div>
<div class="line"><span class="lineno">  114</span>        <span class="comment">// Initialize the variables</span></div>
<div class="line"><span class="lineno">  115</span>        Eigen::Vector3d prev_normal(0, 0, 1);</div>
<div class="line"><span class="lineno">  116</span>        Eigen::Vector3d normal(0, 0, 1);</div>
<div class="line"><span class="lineno">  117</span>        angle_threshold *= (M_PI/180);</div>
<div class="line"><span class="lineno">  118</span>        <span class="keywordtype">double</span> x_step = (Mx - 0) / number_sections;</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordtype">double</span> y_step = (My - (-My)) / number_sections;</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; number_sections; ++i)</div>
<div class="line"><span class="lineno">  122</span>        {</div>
<div class="line"><span class="lineno">  123</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; number_sections; ++j)</div>
<div class="line"><span class="lineno">  124</span>            {</div>
<div class="line"><span class="lineno">  125</span>                <span class="comment">// Define the square</span></div>
<div class="line"><span class="lineno">  126</span>                Eigen::Vector4f min_pt(0 + i * x_step, -My + j * y_step, -100.0, 1.0);</div>
<div class="line"><span class="lineno">  127</span>                Eigen::Vector4f max_pt(0 + (i + 1) * x_step, -My + (j + 1) * y_step, Mz, 1.0);</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>                <span class="comment">// Crop the input cloud to the square measures</span></div>
<div class="line"><span class="lineno">  130</span>                pcl::PointCloud&lt;pcl::PointXYZI&gt;::Ptr grid_cloud(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::PointXYZI&gt;);</div>
<div class="line"><span class="lineno">  131</span>                pcl::CropBox&lt;pcl::PointXYZI&gt; crop_box_filter;</div>
<div class="line"><span class="lineno">  132</span>                crop_box_filter.setInputCloud(cloud);</div>
<div class="line"><span class="lineno">  133</span>                crop_box_filter.setMin(min_pt);</div>
<div class="line"><span class="lineno">  134</span>                crop_box_filter.setMax(max_pt);</div>
<div class="line"><span class="lineno">  135</span>                crop_box_filter.filter(*grid_cloud);</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>                <span class="comment">// Create temporal clouds to store the ground and not ground points and apply ransac</span></div>
<div class="line"><span class="lineno">  138</span>                pcl::PointCloud&lt;pcl::PointXYZI&gt;::Ptr temp_filtered(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::PointXYZI&gt;);</div>
<div class="line"><span class="lineno">  139</span>                pcl::PointCloud&lt;pcl::PointXYZI&gt;::Ptr temp_plane(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::PointXYZI&gt;);</div>
<div class="line"><span class="lineno">  140</span>                <a class="code hl_function" href="namespaceGroundFiltering.html#ac754e959f8a1371a1d4f36bfa5dc348b">ransac_checking_normal_vectors</a>(grid_cloud, temp_filtered, temp_plane, coefficients, threshold, cloud_filtered, cloud_plane, prev_normal, normal, angle_threshold);</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>                <span class="comment">// Update the variables for the next iteration</span></div>
<div class="line"><span class="lineno">  143</span>                prev_normal = normal;</div>
<div class="line"><span class="lineno">  144</span>            }</div>
<div class="line"><span class="lineno">  145</span>        }</div>
<div class="line"><span class="lineno">  146</span>    }</div>
<div class="ttc" id="anamespaceGroundFiltering_html_ac754e959f8a1371a1d4f36bfa5dc348b"><div class="ttname"><a href="namespaceGroundFiltering.html#ac754e959f8a1371a1d4f36bfa5dc348b">GroundFiltering::ransac_checking_normal_vectors</a></div><div class="ttdeci">void ransac_checking_normal_vectors(pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;grid_cloud, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;temp_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;temp_plane, pcl::ModelCoefficients::Ptr &amp;coefficients, double threshold, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_plane, Eigen::Vector3d &amp;prev_normal, Eigen::Vector3d &amp;normal, double angle_threshold)</div><div class="ttdoc">Apply ransac in the square specified and check if the result plane is in accordance with the previus ...</div><div class="ttdef"><b>Definition</b> <a href="ground__filtering_8h_source.html#l00057">ground_filtering.h:57</a></div></div>
</div><!-- fragment --><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_cgraph.png" border="0" usemap="#anamespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_cgraph" alt=""/></div>
<map name="anamespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_cgraph" id="anamespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_cgraph">
<area shape="rect" title="Divide the cloud in the specified numbers of squares as a grid and call the function ransac_checking_..." alt="" coords="5,29,160,69"/>
<area shape="rect" href="namespaceGroundFiltering.html#ac754e959f8a1371a1d4f36bfa5dc348b" title="Apply ransac in the square specified and check if the result plane is in accordance with the previus ..." alt="" coords="208,29,403,69"/>
<area shape="poly" title=" " alt="" coords="160,47,194,47,194,52,160,52"/>
<area shape="poly" title=" " alt="" coords="264,30,261,20,268,10,283,5,305,3,331,6,345,13,343,18,330,11,305,8,284,10,271,15,267,21,269,28"/>
<area shape="rect" href="namespaceGroundFiltering.html#a309b709ff242b65b04b5f22ad501fa08" title="Implements ground filtering using ransac segmentation." alt="" coords="451,29,624,69"/>
<area shape="poly" title=" " alt="" coords="403,47,437,47,437,52,403,52"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_icgraph.png" border="0" usemap="#anamespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_icgraph" alt=""/></div>
<map name="anamespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_icgraph" id="anamespaceGroundFiltering_ad1bc882b476335f839d96597dd767555_icgraph">
<area shape="rect" title="Divide the cloud in the specified numbers of squares as a grid and call the function ransac_checking_..." alt="" coords="459,5,613,45"/>
<area shape="rect" href="classPerception.html#a7c6f9e4953d3780c1827f3cc0cbed09e" title="Callback function for the lidar topic." alt="" coords="221,13,411,38"/>
<area shape="poly" title=" " alt="" coords="445,28,411,28,411,23,445,23"/>
<area shape="rect" href="classPerception.html#a8bcf74df62599f91509d3fd2df14c5f7" title="Construct a new Perception object." alt="" coords="5,13,173,38"/>
<area shape="poly" title=" " alt="" coords="208,28,174,28,174,23,208,23"/>
</map>
</div>

</div>
</div>
<a id="a583f7dbed92468f3ec6993b0abdde77a" name="a583f7dbed92468f3ec6993b0abdde77a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a583f7dbed92468f3ec6993b0abdde77a">&#9670;&#160;</a></span>pillar_ground_filter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GroundFiltering::pillar_ground_filter </td>
          <td>(</td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_filtered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>ground_cloud</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Mx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>My</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>number_sections</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ground__filtering_8h_source.html#l00148">148</a> of file <a class="el" href="ground__filtering_8h_source.html">ground_filtering.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  151</span>    {</div>
<div class="line"><span class="lineno">  152</span>        cloud_filtered-&gt;clear();</div>
<div class="line"><span class="lineno">  153</span>        ground_cloud-&gt;clear();</div>
<div class="line"><span class="lineno">  154</span>        std::map&lt;std::pair&lt;int, int&gt;, pcl::PointCloud&lt;pcl::PointXYZI&gt;::Ptr&gt; cloud_grid;</div>
<div class="line"><span class="lineno">  155</span>    </div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; point : cloud-&gt;points) {</div>
<div class="line"><span class="lineno">  159</span>            <span class="keywordtype">int</span> x_index = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((point.x/Mx) * number_sections);</div>
<div class="line"><span class="lineno">  160</span>            <span class="keywordtype">int</span> y_index = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((point.y + My) / (2 * My) * number_sections);</div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>            <span class="keywordflow">if</span> (x_index &lt; 0 || x_index &gt;= number_sections || y_index &lt; 0 || y_index &gt;= number_sections)</div>
<div class="line"><span class="lineno">  163</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>            std::pair&lt;int, int&gt; grid_key(x_index, y_index);</div>
<div class="line"><span class="lineno">  166</span>            <span class="keywordflow">if</span> (cloud_grid.find(grid_key) == cloud_grid.end()) {</div>
<div class="line"><span class="lineno">  167</span>                cloud_grid[grid_key] = std::make_shared&lt;pcl::PointCloud&lt;pcl::PointXYZI&gt;&gt;();</div>
<div class="line"><span class="lineno">  168</span>            }</div>
<div class="line"><span class="lineno">  169</span>            cloud_grid[grid_key]-&gt;points.push_back(point);</div>
<div class="line"><span class="lineno">  170</span>        }</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>        pcl::PointXYZI min_pt, max_pt;</div>
<div class="line"><span class="lineno">  173</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [key, cell_cloud] : cloud_grid) {</div>
<div class="line"><span class="lineno">  174</span>            pcl::getMinMax3D(*cell_cloud, min_pt, max_pt);</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>            <span class="keywordflow">if</span> (max_pt.z - min_pt.z &lt; threshold) {</div>
<div class="line"><span class="lineno">  177</span>                *ground_cloud += *cell_cloud;</div>
<div class="line"><span class="lineno">  178</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (max_pt.z - min_pt.z &lt; 0.4 &amp;&amp; max_pt.z &lt; 1.0) { <span class="comment">// Avoid high pillars such as walls or buildings</span></div>
<div class="line"><span class="lineno">  179</span>                *cloud_filtered += *cell_cloud;</div>
<div class="line"><span class="lineno">  180</span>            }</div>
<div class="line"><span class="lineno">  181</span>        }</div>
<div class="line"><span class="lineno">  182</span>    }</div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceGroundFiltering_a583f7dbed92468f3ec6993b0abdde77a_icgraph.png" border="0" usemap="#anamespaceGroundFiltering_a583f7dbed92468f3ec6993b0abdde77a_icgraph" alt=""/></div>
<map name="anamespaceGroundFiltering_a583f7dbed92468f3ec6993b0abdde77a_icgraph" id="anamespaceGroundFiltering_a583f7dbed92468f3ec6993b0abdde77a_icgraph">
<area shape="rect" title=" " alt="" coords="459,5,621,45"/>
<area shape="rect" href="classPerception.html#a7c6f9e4953d3780c1827f3cc0cbed09e" title="Callback function for the lidar topic." alt="" coords="221,13,411,38"/>
<area shape="poly" title=" " alt="" coords="445,28,411,28,411,23,445,23"/>
<area shape="rect" href="classPerception.html#a8bcf74df62599f91509d3fd2df14c5f7" title="Construct a new Perception object." alt="" coords="5,13,173,38"/>
<area shape="poly" title=" " alt="" coords="208,28,174,28,174,23,208,23"/>
</map>
</div>

</div>
</div>
<a id="ac754e959f8a1371a1d4f36bfa5dc348b" name="ac754e959f8a1371a1d4f36bfa5dc348b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac754e959f8a1371a1d4f36bfa5dc348b">&#9670;&#160;</a></span>ransac_checking_normal_vectors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GroundFiltering::ransac_checking_normal_vectors </td>
          <td>(</td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>grid_cloud</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>temp_filtered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>temp_plane</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::ModelCoefficients::Ptr &amp;&#160;</td>
          <td class="paramname"><em>coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_filtered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_plane</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::Vector3d &amp;&#160;</td>
          <td class="paramname"><em>prev_normal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Eigen::Vector3d &amp;&#160;</td>
          <td class="paramname"><em>normal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>angle_threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply ransac in the square specified and check if the result plane is in accordance with the previus ground plane by measuring the angle between their normal vectors, repeating the process until it succeed. </p>

<p class="definition">Definition at line <a class="el" href="ground__filtering_8h_source.html#l00057">57</a> of file <a class="el" href="ground__filtering_8h_source.html">ground_filtering.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   61</span>    {</div>
<div class="line"><span class="lineno">   62</span>        <span class="comment">// Filter the squares with just a few points</span></div>
<div class="line"><span class="lineno">   63</span>        <span class="keywordflow">if</span> (!(grid_cloud-&gt;size() &lt; <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(30)))</div>
<div class="line"><span class="lineno">   64</span>        {</div>
<div class="line"><span class="lineno">   65</span>            <span class="comment">// Create new temporal clouds to store the ground and not ground points and apply ransc</span></div>
<div class="line"><span class="lineno">   66</span>            pcl::PointCloud&lt;pcl::PointXYZI&gt;::Ptr new_temp_filtered(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::PointXYZI&gt;);</div>
<div class="line"><span class="lineno">   67</span>            pcl::PointCloud&lt;pcl::PointXYZI&gt;::Ptr new_temp_plane(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::PointXYZI&gt;);</div>
<div class="line"><span class="lineno">   68</span>            <a class="code hl_function" href="namespaceGroundFiltering.html#a309b709ff242b65b04b5f22ad501fa08">ransac_ground_filter</a>(grid_cloud, temp_filtered, temp_plane, coefficients, threshold);</div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span>            <span class="comment">// Extract the coefficients of the plane of ecuation Ax + By + Cz + D = 0</span></div>
<div class="line"><span class="lineno">   71</span>            <span class="keywordtype">double</span> A = coefficients-&gt;values[0];</div>
<div class="line"><span class="lineno">   72</span>            <span class="keywordtype">double</span> B = coefficients-&gt;values[1];</div>
<div class="line"><span class="lineno">   73</span>            <span class="keywordtype">double</span> C = coefficients-&gt;values[2];</div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>            <span class="comment">// Calculate angle between the two vector using the dot product</span></div>
<div class="line"><span class="lineno">   76</span>            normal = Eigen::Vector3d(A, B, C).normalized();</div>
<div class="line"><span class="lineno">   77</span>            <span class="keywordtype">double</span> cos_angle = prev_normal.dot(normal);</div>
<div class="line"><span class="lineno">   78</span>            <span class="keywordtype">double</span> angle = std::acos(cos_angle);</div>
<div class="line"><span class="lineno">   79</span>            </div>
<div class="line"><span class="lineno">   80</span>            <span class="keywordflow">if</span> (angle &gt; angle_threshold)</div>
<div class="line"><span class="lineno">   81</span>            {</div>
<div class="line"><span class="lineno">   82</span>                <span class="comment">// Store the points in cloud filtered as it is not ground</span></div>
<div class="line"><span class="lineno">   83</span>                *cloud_plane += *temp_plane;</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span>                <span class="comment">// Call the function again until the ground is suitable</span></div>
<div class="line"><span class="lineno">   86</span>                <a class="code hl_function" href="namespaceGroundFiltering.html#ac754e959f8a1371a1d4f36bfa5dc348b">ransac_checking_normal_vectors</a>(temp_filtered, new_temp_filtered, new_temp_plane, coefficients, threshold, cloud_filtered, cloud_plane, </div>
<div class="line"><span class="lineno">   87</span>                    prev_normal, normal, angle_threshold);</div>
<div class="line"><span class="lineno">   88</span>            }</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>            <span class="keywordflow">if</span> (new_temp_filtered-&gt;points.empty())</div>
<div class="line"><span class="lineno">   91</span>            {</div>
<div class="line"><span class="lineno">   92</span>                <span class="comment">// Store the ground and not ground points in the specified clouds</span></div>
<div class="line"><span class="lineno">   93</span>                *cloud_filtered += *temp_filtered;</div>
<div class="line"><span class="lineno">   94</span>                *cloud_plane += *temp_plane;</div>
<div class="line"><span class="lineno">   95</span>            }</div>
<div class="line"><span class="lineno">   96</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   97</span>            {</div>
<div class="line"><span class="lineno">   98</span>                <span class="comment">// Store the ground and not ground points in the specified clouds</span></div>
<div class="line"><span class="lineno">   99</span>                *cloud_filtered += *new_temp_filtered;</div>
<div class="line"><span class="lineno">  100</span>                *cloud_plane += *new_temp_plane;</div>
<div class="line"><span class="lineno">  101</span>            }</div>
<div class="line"><span class="lineno">  102</span>        }</div>
<div class="line"><span class="lineno">  103</span>    }</div>
<div class="ttc" id="anamespaceGroundFiltering_html_a309b709ff242b65b04b5f22ad501fa08"><div class="ttname"><a href="namespaceGroundFiltering.html#a309b709ff242b65b04b5f22ad501fa08">GroundFiltering::ransac_ground_filter</a></div><div class="ttdeci">void ransac_ground_filter(pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_filtered, pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;cloud_plane, pcl::ModelCoefficients::Ptr &amp;coefficients, double threshold)</div><div class="ttdoc">Implements ground filtering using ransac segmentation.</div><div class="ttdef"><b>Definition</b> <a href="ground__filtering_8h_source.html#l00019">ground_filtering.h:19</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_cgraph.png" border="0" usemap="#anamespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_cgraph" alt=""/></div>
<map name="anamespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_cgraph" id="anamespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_cgraph">
<area shape="rect" title="Apply ransac in the square specified and check if the result plane is in accordance with the previus ..." alt="" coords="5,29,200,69"/>
<area shape="poly" title=" " alt="" coords="59,30,57,20,64,10,79,5,103,3,130,6,144,13,142,18,128,11,103,8,80,10,67,15,62,21,64,28"/>
<area shape="rect" href="namespaceGroundFiltering.html#a309b709ff242b65b04b5f22ad501fa08" title="Implements ground filtering using ransac segmentation." alt="" coords="248,29,421,69"/>
<area shape="poly" title=" " alt="" coords="201,47,234,47,234,52,201,52"/>
</map>
</div>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_icgraph.png" border="0" usemap="#anamespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_icgraph" alt=""/></div>
<map name="anamespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_icgraph" id="anamespaceGroundFiltering_ac754e959f8a1371a1d4f36bfa5dc348b_icgraph">
<area shape="rect" title="Apply ransac in the square specified and check if the result plane is in accordance with the previus ..." alt="" coords="661,29,856,69"/>
<area shape="poly" title=" " alt="" coords="796,18,783,11,759,8,737,10,725,15,720,21,722,28,717,30,715,20,721,10,736,5,759,3,785,6,799,13"/>
<area shape="rect" href="namespaceGroundFiltering.html#ad1bc882b476335f839d96597dd767555" title="Divide the cloud in the specified numbers of squares as a grid and call the function ransac_checking_..." alt="" coords="459,29,613,69"/>
<area shape="poly" title=" " alt="" coords="647,52,614,52,614,47,647,47"/>
<area shape="rect" href="classPerception.html#a7c6f9e4953d3780c1827f3cc0cbed09e" title="Callback function for the lidar topic." alt="" coords="221,37,411,62"/>
<area shape="poly" title=" " alt="" coords="445,52,411,52,411,47,445,47"/>
<area shape="rect" href="classPerception.html#a8bcf74df62599f91509d3fd2df14c5f7" title="Construct a new Perception object." alt="" coords="5,37,173,62"/>
<area shape="poly" title=" " alt="" coords="208,52,174,52,174,47,208,47"/>
</map>
</div>

</div>
</div>
<a id="a309b709ff242b65b04b5f22ad501fa08" name="a309b709ff242b65b04b5f22ad501fa08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a309b709ff242b65b04b5f22ad501fa08">&#9670;&#160;</a></span>ransac_ground_filter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GroundFiltering::ransac_ground_filter </td>
          <td>(</td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_filtered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::PointCloud&lt; pcl::PointXYZI &gt;::Ptr &amp;&#160;</td>
          <td class="paramname"><em>cloud_plane</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pcl::ModelCoefficients::Ptr &amp;&#160;</td>
          <td class="paramname"><em>coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements ground filtering using ransac segmentation. </p>

<p class="definition">Definition at line <a class="el" href="ground__filtering_8h_source.html#l00019">19</a> of file <a class="el" href="ground__filtering_8h_source.html">ground_filtering.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   21</span>    {   </div>
<div class="line"><span class="lineno">   22</span>        <span class="comment">// Define the parameters</span></div>
<div class="line"><span class="lineno">   23</span>        pcl::SACSegmentation&lt;pcl::PointXYZI&gt; segmentation;</div>
<div class="line"><span class="lineno">   24</span>        pcl::PointIndices::Ptr inliers(<span class="keyword">new</span> pcl::PointIndices);</div>
<div class="line"><span class="lineno">   25</span>        pcl::PointIndices::Ptr outliers(<span class="keyword">new</span> pcl::PointIndices);</div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>        <span class="comment">// Configure the algorithm</span></div>
<div class="line"><span class="lineno">   28</span>        segmentation.setOptimizeCoefficients(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">   29</span>        segmentation.setModelType(pcl::SACMODEL_PLANE);</div>
<div class="line"><span class="lineno">   30</span>        segmentation.setMethodType(pcl::SAC_RANSAC);</div>
<div class="line"><span class="lineno">   31</span>        segmentation.setMaxIterations(200);</div>
<div class="line"><span class="lineno">   32</span>        segmentation.setDistanceThreshold(threshold);</div>
<div class="line"><span class="lineno">   33</span> </div>
<div class="line"><span class="lineno">   34</span>        <span class="comment">// Aply the segmentation</span></div>
<div class="line"><span class="lineno">   35</span>        segmentation.setInputCloud(cloud);</div>
<div class="line"><span class="lineno">   36</span>        segmentation.segment(*inliers, *coefficients);</div>
<div class="line"><span class="lineno">   37</span>         </div>
<div class="line"><span class="lineno">   38</span>        <span class="comment">// Extract the planar inliers from the input cloud</span></div>
<div class="line"><span class="lineno">   39</span>        pcl::ExtractIndices&lt;pcl::PointXYZI&gt; extract;</div>
<div class="line"><span class="lineno">   40</span>        extract.setInputCloud(cloud);</div>
<div class="line"><span class="lineno">   41</span>        extract.setIndices(inliers);</div>
<div class="line"><span class="lineno">   42</span> </div>
<div class="line"><span class="lineno">   43</span>        <span class="comment">// Store the not planar points</span></div>
<div class="line"><span class="lineno">   44</span>        extract.setNegative(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">   45</span>        extract.filter(*cloud_filtered);</div>
<div class="line"><span class="lineno">   46</span>        extract.filter(outliers-&gt;indices);</div>
<div class="line"><span class="lineno">   47</span> </div>
<div class="line"><span class="lineno">   48</span>        <span class="comment">// Store the planar points</span></div>
<div class="line"><span class="lineno">   49</span>        extract.setNegative(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">   50</span>        extract.filter(*cloud_plane);</div>
<div class="line"><span class="lineno">   51</span>    }</div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceGroundFiltering_a309b709ff242b65b04b5f22ad501fa08_icgraph.png" border="0" usemap="#anamespaceGroundFiltering_a309b709ff242b65b04b5f22ad501fa08_icgraph" alt=""/></div>
<map name="anamespaceGroundFiltering_a309b709ff242b65b04b5f22ad501fa08_icgraph" id="anamespaceGroundFiltering_a309b709ff242b65b04b5f22ad501fa08_icgraph">
<area shape="rect" title="Implements ground filtering using ransac segmentation." alt="" coords="924,49,1097,89"/>
<area shape="rect" href="classPerception.html#adc23cc0d2e3ae4d8c10c46e6841c36e8" title=" " alt="" coords="459,5,633,31"/>
<area shape="poly" title=" " alt="" coords="910,57,876,53,633,28,634,23,876,47,911,52"/>
<area shape="rect" href="classPerception.html#a7c6f9e4953d3780c1827f3cc0cbed09e" title="Callback function for the lidar topic." alt="" coords="221,56,411,81"/>
<area shape="poly" title=" " alt="" coords="910,71,411,71,411,66,910,66"/>
<area shape="rect" href="namespaceGroundFiltering.html#ac754e959f8a1371a1d4f36bfa5dc348b" title="Apply ransac in the square specified and check if the result plane is in accordance with the previus ..." alt="" coords="681,130,876,170"/>
<area shape="poly" title=" " alt="" coords="941,96,837,132,836,127,939,91"/>
<area shape="poly" title=" " alt="" coords="475,36,375,59,374,53,473,31"/>
<area shape="rect" href="classPerception.html#a8bcf74df62599f91509d3fd2df14c5f7" title="Construct a new Perception object." alt="" coords="5,56,173,81"/>
<area shape="poly" title=" " alt="" coords="208,71,174,71,174,66,208,66"/>
<area shape="poly" title=" " alt="" coords="818,118,804,111,779,109,756,111,743,115,738,121,740,129,735,130,733,120,740,111,755,105,779,103,806,106,820,113"/>
<area shape="rect" href="namespaceGroundFiltering.html#ad1bc882b476335f839d96597dd767555" title="Divide the cloud in the specified numbers of squares as a grid and call the function ransac_checking_..." alt="" coords="469,118,623,158"/>
<area shape="poly" title=" " alt="" coords="667,147,623,145,624,139,668,142"/>
<area shape="poly" title=" " alt="" coords="465,117,358,84,360,79,467,111"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
